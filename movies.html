<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="css/styles.css"/>
</head>
<body>
<div id="wrap" class="wrap"></div>
<script src="https://fb.me/react-0.13.3.js"></script>
<!--<script src="https://fb.me/react-0.13.3.min.js"></script>-->
<script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
<script type="text/jsx">

    var MovieGridCard = React.createClass({
       render: function() {

           var mov = this.props.movie;

           return (
                   <div className="movie-grid-card">
                       <img src={mov.poster_image_url}/><br/>
                       {mov.title}<br/>
                       {mov.storyline}
                   </div>
           )
       }
    });

    var SearchBar = React.createClass({
        handleChange: function() {
            this.props.onUserInput(
                    this.refs.filterTextInput.getDOMNode().value,
                    this.refs.moviesWithBooksInput.getDOMNode().checked
            );
        },
        render: function() {
            return (
                    <form>
                        <input
                                type="text"
                                placeholder="Search..."
                                value={this.props.filterText}
                                ref="filterTextInput"
                                onChange={this.handleChange}
                                />
                        <p>
                            <input
                                    type="checkbox"
                                    checked={this.props.moviesWithBooks}
                                    ref="moviesWithBooksInput"
                                    onChange={this.handleChange}
                                    />
                            {' '}
                            Only show movies with books
                        </p>
                    </form>
            );
        }
    });

    var MovieGrid = React.createClass({
        render: function() {

            var rows = [];
            console.log(this.props);
            this.props.movies.forEach(function(movie) {

                if (movie.title.indexOf(this.props.filterText) === -1) {
                    return;
                }

                rows.push(<MovieGridCard movie={movie} key={movie.title}></MovieGridCard>);
            }.bind(this));
            return (
                    <div>
                        {rows}
                    </div>
            );
        }
    });

    var MoviePage = React.createClass({
        getInitialState: function() {
            return {
                filterText: '',
                moviesWithBooks: false
            };
        },

        handleUserInput: function(filterText, moviesWithBooks) {
            this.setState({
                filterText: filterText,
                moviesWithBooks: moviesWithBooks
            });
        },

        render: function() {
            return (
                    <div className="movie-page">
                        <SearchBar
                                filterText={this.state.filterText}
                                moviesWithBooks={this.state.moviesWithBooks}
                                onUserInput={this.handleUserInput}
                                />
                        <MovieGrid
                                filterText={this.state.filterText}
                                moviesWithBooks={this.state.moviesWithBooks}
                                movies={this.props.movies}
                                />
                    </div>
            );
        }
    });

    var movies = "{%media%}";

    React.render(<MoviePage movies={movies} />, document.getElementById('wrap'))
</script>
</body>
</html>
