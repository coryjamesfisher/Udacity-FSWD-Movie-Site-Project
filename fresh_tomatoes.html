<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>

<script src="https://fb.me/react-0.13.3.js"></script>
<!--<script src="https://fb.me/react-0.13.3.min.js"></script>-->
<script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
<script type="text/jsx">

    var MovieGridCard = React.createClass({
       render: function() {

           var mov = this.props.movie;

           return (
                   <div style={{width: 300 + 'px', float: 'left'}}>
                       <img src={mov.poster_image_url}/>
                       {mov.name}
                       {mov.storyline}
                   </div>
           )
       }
    });

    var SearchBar = React.createClass({
        handleChange: function() {
            this.props.onUserInput(
                    this.refs.filterTextInput.getDOMNode().value,
                    this.refs.moviesWithBooksInput.getDOMNode().checked
            );
        },
        render: function() {
            return (
                    <form>
                        <input
                                type="text"
                                placeholder="Search..."
                                value={this.props.filterText}
                                ref="filterTextInput"
                                onChange={this.handleChange}
                                />
                        <p>
                            <input
                                    type="checkbox"
                                    checked={this.props.moviesWithBooks}
                                    ref="moviesWithBooksInput"
                                    onChange={this.handleChange}
                                    />
                            {' '}
                            Only show movies with books
                        </p>
                    </form>
            );
        }
    });

    var MovieGrid = React.createClass({
        render: function() {

            var rows = [];
            console.log(this.props);
            this.props.movies.forEach(function(movie) {

                if (movie.name.indexOf(this.props.filterText) === -1) {
                    return;
                }

                rows.push(<MovieGridCard movie={movie} key={movie.name}></MovieGridCard>);
            }.bind(this));
            return (
                    <div>
                        {rows}
                    </div>
            );
        }
    });

    var MoviePage = React.createClass({
        getInitialState: function() {
            return {
                filterText: '',
                moviesWithBooks: false
            };
        },

        handleUserInput: function(filterText, moviesWithBooks) {
            this.setState({
                filterText: filterText,
                moviesWithBooks: moviesWithBooks
            });
        },

        render: function() {
            return (
                    <div>
                        <SearchBar
                                filterText={this.state.filterText}
                                moviesWithBooks={this.state.moviesWithBooks}
                                onUserInput={this.handleUserInput}
                                />
                        <MovieGrid
                                filterText={this.state.filterText}
                                moviesWithBooks={this.state.moviesWithBooks}
                                movies={this.props.movies}
                                />
                    </div>
            );
        }
    });

    var movies = [{name:"Spirited Away",storyline:"During her family's move to the suburbs, a sullen 10-year-old girl wanders into a world ruled by gods, witches, and spirits, and where humans are changed into beasts.",poster_image_url:"https://upload.wikimedia.org/wikipedia/en/3/30/Spirited_Away_poster.JPG",trailer_youtube_url:"https://www.youtube.com/watch?v=ByXuk9QqQkk"},{name:"Princess Mononoke",storyline:"On a journey to find the cure for a Tatarigami's curse, Ashitaka finds himself in the middle of a war between the forest gods and Tatara, a mining colony. In this quest he also meets San, the Mononoke Hime.",poster_image_url:"http://ia.media-imdb.com/images/M/MV5BMjgzNTUwODQzN15BMl5BanBnXkFtZTcwMTc4ODE3OQ@@._V1_SX214_AL_.jpg",trailer_youtube_url:"https://www.youtube.com/watch?v=4OiMOHRDs14"},{name:"Howl's Moving Castle",storyline:"When an unconfident young woman is cursed with an old body by a spiteful witch, her only chance of breaking the spell lies with a self-indulgent yet insecure young wizard and his companions in his legged, walking castle.",poster_image_url:"http://ia.media-imdb.com/images/M/MV5BMTY1OTg0MjE3MV5BMl5BanBnXkFtZTcwNTUxMTkyMQ@@._V1_SX214_AL_.jpg",trailer_youtube_url:"https://www.youtube.com/watch?v=iwROgK94zcM"},{name:"Kiki's Delivery Service",storyline:"A young witch, on her mandatory year of independent life, finds fitting into a new community difficult while she supports herself by running an air courier service.",poster_image_url:"http://ia.media-imdb.com/images/M/MV5BOTc0ODM1Njk1NF5BMl5BanBnXkFtZTcwMDI5OTEyNw@@._V1_SY317_CR4,0,214,317_AL_.jpg",trailer_youtube_url:"https://www.youtube.com/watch?v=4bG17OYs-GA"},{name:"Nausicaä of the Valley of the Wind",storyline:"Warrior/pacifist Princess Nausicaä desperately struggles to prevent two warring nations from destroying themselves and their dying planet.",poster_image_url:"http://ia.media-imdb.com/images/M/MV5BMTM1NjIxNTY4OF5BMl5BanBnXkFtZTcwNDE5MDIyNw@@._V1_SY317_CR5,0,214,317_AL_.jpg",trailer_youtube_url:"https://www.youtube.com/watch?v=6zhLBe319KE"}];
//    movies.push({name:"Princess Mononoke", storyline:"On a journey to find the cure for a Tatarigami's curse, Ashitaka finds himself in the middle of a war between the forest gods and Tatara, a mining colony. In this quest he also meets San, the Mononoke Hime."});

    React.render(<MoviePage movies={movies} />, document.body)
</script>
</body>
</html>